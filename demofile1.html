<!doctype html>
<html>
  <head>
    <title>SnackFox</title>
	<style>

body, html {
  height: 100%;
  margin: 0;
  font-family: Arial, Helvetica, sans-serif;
  text-align: center;
  padding:0;
  color:#FFFFFF;
	font-weight:300;
	font-family:'Roboto',sans-serif;
	line-height:1.55;
	overflow-x:hidden;
}
table, th, td {
  border-collapse: collapse;
  margin-left:auto;
  margin-right:auto;
}
th, td {
  padding: 5px;  
}

.myimg{
  width:50px;
  height:50px;
  object-fit:cover;
  border-radius:50%;
}

li {
  list-style: none;
}

#leaderboard li {
  font-family:'Roboto',sans-serif;
		font-size: 12px;
		line-height: 12px;
    color:#0f0919;
	}

	#leaderboard #players li {
		display:block;
		clear: both;
		position: absolute;
		width: 400px;
		-moz-transition-duration: 1s;
		-webkit-transition-duration: 1s;
		-ms-transition-duration: 1s;
	}

	#leaderboard #players li.header {
		font-weight: bold;
		background-color: silver;
		background: -moz-linear-gradient(top, #cedce7 0%, #596a72 100%);
		background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#cedce7), color-stop(100%,#596a72));
	}

	#leaderboard #players {
		padding: 0;
		width: 400px;
		position: relative;
		border: 1px solid #333;
		box-shadow: 2px 2px 5px gray;
		height: 132px;
		background: -moz-linear-gradient(top, #cedce7 0%, #596a72 100%);
		background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#cedce7), color-stop(100%,#596a72));
	}

	#leaderboard #players div {
		display: block;
		float: left;
		overflow: hidden;
		padding: 5px;
	}

	#leaderboard .player {
		background: -moz-linear-gradient(top, #feffff 0%, #e0dace 100%);
		background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#feffff), color-stop(100%,#e0dace));
	}

	#leaderboard .rank {
		width: 50px;
	}

  #leaderboard .pfp {
		width: 50px;
	}

	#leaderboard .name {
		width: 150px;
	}

	#leaderboard .score {
		width: 100px;	
	}

@font-face {
	font-family: 'Roboto';
	font-style: normal;
	font-weight: 300;
	src: url("Roboto-Light.woff") format('woff');
}
.bttn{
	display:inline-block;
	font-size:1.32em;
  min-width: 100px;
	padding:0.3em 0.75em;
	margin:0.5em 0.8em 0.5em 0;
	border:0.1em solid #FFFFFF;
	border-radius:0.12em;
	transition: all 0.2s;
	text-decoration:none;
	font-weight:400;
  font-size:1.5em;
}
.bttn:hover, .bttn:focus, .bttn:active{
	color:#000000 !important;
	background-color:#FFFFFF !important;
	font-weight:400;
}
.bg {
   background-image: linear-gradient(45deg, #6a3093, #a044ff); 
  height: 100%; 
  background-position: center;
  background-repeat: no-repeat;
  background-size: cover;
}
#card1, #card2{
  border-color: #C1E0FF;
  border-width:0px;
  border-style:solid;
}
#background{
	position:fixed;
	z-index:-1;
	top:0;
	left:0;
	width:100vw;
	height:100vh;
	overflow:hidden;
	background-color:#0f0919;
}
#bkFrame{
  width:100vw;
	height:100vh;
}
#progress {
  margin: 20px;
  width: 100px;
  top:0px;
  left:0px;
  height: 100px;
  position: relative;
}
@font-face {
    font-family: 'Lato';
    src: url('lato-black.woff') format('woff');
    font-weight: 900;
    font-style: normal;
}
@font-face {
    font-family: 'Lato';
    src: url('lato-bold.woff') format('woff');
    font-weight: 700;
    font-style: normal;
}
h1,h2,h3,h4,h5,h6{
	font-family:'Lato', sans-serif;
	color:#FFFFFF;
	margin:1.7em 0 0.5em 0;
	font-weight:900;
	line-height:1em;
	text-transform:uppercase;
}
.center {
  margin: auto;
  text-align: center;
}

.container {
  width: 30%;
  height: 70%;
  position: relative;
  perspective: 800px;
}

.card {
  width: 100%;
  height: 100%;
  padding: 0px;
  position: absolute;
  transform-style: preserve-3d;
  transition: transform 1s;
}

.card figure {
  margin: 0;
  display: block;
  position: absolute;
  width: 100%;
  height: 100%;
  backface-visibility: hidden;
}

.card .front {
  background: #FFFFF0;
  display: flex;
  border-radius: 25px;
  justify-content: center;
  align-items: center;
  width: 100%;
  height: 100%;
}

.card .back {
  background: #FFFFF0;
  border-radius: 25px;
  transform: rotateY( 180deg);
}

.card.flipped {
  transform: rotateY( 180deg);
}
#frontText1,#frontText2{
    max-height: 100%;
    font-size: 40px;
}
#frontImage1,#frontImage2{
  width:90%;
  height:90%;
}
#backText1, #backText2 #backImage1 #backImage2{
    height: 40%;
    font-size: 40px;
}
#backName1,#backName2{
    height: 20%;
    font-size: 40px;
}
#votes1,#votes2{
    height: 40%;
    font-size: 20px;
}
.no-resize, .resize {
  width: 90%;
    height:90%;
    color: #111;
   
    text-align: center;
    display: inline-block
}
</style>
<meta name="viewport" content="width=device-width, initial-scale=1" /> 
  </head>
  <body  onresize="autoSizeText()">
    <script type="text/javascript" src="/background.js"></script>
    <div id="background">
      <canvas id="bkFrame" width="100px" height="100px">fsfsdfsdfsd</canvas>
      <script type="text/javascript">
        spaceBg=new WarpSpeed("bkFrame",{targetSpeed:0.8,speedWhileLoading:8, speedAdjFactor:0.07, shape:"square", backgroundColor:"hsl(263,45%,8%)", speedWhileLoading:18,density:2.6});
      </script>
    </div>
    <p id="countdown"></p>
  <div id ="bg" style="width: 100%; height:100%;"> 
  <div id="welcomeScreen">
	  <h1>Welcome to Quipflash</h1>
		<p>From the creators of PhotoJoke & Melvin's Graphs</p>
		<ul id="messages"></ul>
		<form class="center" id="myForm">
		  <input id="m" placeholder="Enter Name">
    </form>
    <div id="signin"><p class="bttn" >Play</p></div>
	</div>
	<div id="selectRoomScreen" style='display:none;'>
		 <h2>Select a room</h2>
		 <p class="bttn" id="createroom">Create a room</p>
		 <ul id="rooms"></ul>
  </div>
  <div id="lobbyScreen" style='display:none;'>
    <h2 id="lobbyName">lobbyScreen</h2>
    <table id="lobbyPlayers"></table>
    <div id="leave"><p class="bttn" >Leave</p></div>
    <div  id="startGame" style='display:none;'><p class="bttn">Start Game</p></div>
 </div>
 <div id="questionScreen" style='display:none;'>
  <form class="center" id="questionForm">
    <label id="questionLabel">Question goes here</label>
    <br>
    <input id="answerImage" type="file" accept="image/*">
    <input id="answer" placeholder="Type Answer">
  </form>
  <div id="answerButton"><p class="bttn" >Submit</p></div>
 </div>
 <div id="waitingScreen" style='display:none;'>
  <h4>Waiting for players</h4>
 </div>
 <div id="leaderboardScreen" style='display:none;'>
  <h4>Leaderboard goes here</h4>
  <div style='display:inline-block;width:400px'>
  
  <div id="leaderboard">
    <ul id="players">
      <li class="header">
        <div class="rank">Rank</div>
        <div class="pfp"></div>
        <div class="name">Player</div>
        <div class="score">Score</div>
      </li>
    </ul>
  </div>
</div>
 </div>
 <div id="votingScreen" style="width: 100%; height:100%;display:none;">
  
  <h1 id="questionlab"></h1>
  <br>
  <div style="width: 100%; height:60%; display: table;">
        <div style="display: table-row">
          <section class="container" style="display: table-cell; width: 2.5%;"></section>
            <section class="container" style="display: table-cell;" id="card1">
                <div id="leftcard" class="card">
                  <figure class="front" id="front">
                      <div class='resize' id="frontText1">Eating poop out the toilet is very bad for your health loling poop out the toilet is very bad for your health loling poop out the toilet is very bad for your health lolololol</div>
                      <div id="frontImage1"></div>
                  </figure>
                  <figure class="back" class="card">
                      <div class='resize' id="backName1">Jamie's answer</div>
                      <div class='resize' id="backText1">Eating poop out the toilet is very bad for your health lolololol</div>
                      <div class='resize' id="votes1">Eating poop out the toilet is very bad for your health lolololol</div>
                  </figure>
                </div>
              </section>
              <section class="container" style="display: table-cell; width: 5%;">
                
              </section>
              <section class="container" style="display: table-cell;" id="card2">
                  <div id="rightcard" class="card">
                    <figure class="front" id="front">
                        <div class='resize' id="frontText2">Eating poop out the toilet is very bad for your health loling poop out the toilet is very bad for your health loling poop out the toilet is very bad for your health lolololol</div>
                        <div id="frontImage2">Eating poop out the toilet is very bad for your health loling poop out the toilet is very bad for your health loling poop out the toilet is very bad for your health lolololol</div>
                    </figure>
                    <figure class="back">
                        <div class='resize' id="backName2">Jamie's answer</div>
                        <div class='resize' id="backText2">Eating poop out the toilet is very bad for your health lolololol</div>
                        <div class='resize' id="votes2">Eating poop out the toilet is very bad for your health lolololol</div>
                    </figure>
                  </div>
                </section>
                <section class="container" style="display: table-cell; width: 2.5%;"></section>
               
        </div>
        
    </div>

 </div>
</div>
<div id="progress" style='display:none;'>
</div>
<script>
  var card = document.getElementById('leftcard');
document.getElementById('flip').addEventListener('click', function() {
card.classList.toggle('flipped');

autoSizeText();
}, false);
  </script>
	<script src="/socket.io/socket.io.js"></script>
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <script src="https://rawgit.com/kimmobrunfeldt/progressbar.js/1.0.0/dist/progressbar.js"></script>
  <script>
    var autoSizeText;
autoSizeText = function() {
  var el, elements, _i, _len, _results;
  elements = $('.resize');
  console.log(elements);
  if (elements.length < 0) {
    return;
  }
  _results = [];
  for (_i = 0, _len = elements.length; _i < _len; _i++) {
    el = elements[_i];
    _results.push((function(el) {
      var resizeText, _results1;
      resizeText = function() {
        var elNewFontSize;
        elNewFontSize = (parseInt($(el).css('font-size').slice(0, -2)) - 1) + 'px';
        return $(el).css('font-size', elNewFontSize);
      };
      _results1 = [];
      while (el.scrollHeight > el.offsetHeight) {
        _results1.push(resizeText());
      }
       return _results1;
    })(el));
  }
  return _results;
};

$(document).ready(function() {
  
  return autoSizeText();
});
</script>
<script>
var player = {name: "hello",room: "", isHost:false, score:0,img:"",lastRank:-1};
var round = 1;
 var socket = io();
 players = {};
 var questions = [];
 var hasVoted = false;

 var rawFile = new XMLHttpRequest();
	rawFile.open("GET", "profilePictures.csv", false);
rawFile.send(null);
var allText = rawFile.responseText;
      
var profilePictures = rawFile.responseText.toString('utf-8').split("\n");


 var bar = new ProgressBar.Circle("#progress", {
  color: '#aaa',
  // This has to be the same size as the maximum width to
  // prevent clipping
  strokeWidth: 4,
  trailWidth: 1,
  easing: 'linear',
  duration: 45000,
  text: {
    autoStyleContainer: false
  },
  from: { color: '#ED6A5A', width: 6 },
  to: { color: '#FFEA82', width: 6 },
  // Set default step function for all animate calls
  step: function(state, circle) {
    circle.path.setAttribute('stroke', state.color);
    circle.path.setAttribute('stroke-width', state.width);

    var value = Math.round(circle.value()*45);
    if (value === 0) {
      circle.setText('');
    } else {
      circle.setText(value);
    }

  }
});
bar.text.style.fontFamily = '"Raleway", Helvetica, sans-serif';
bar.text.style.fontSize = '2rem';
bar.set(1.0)
var spaceBg;

var lastTime = -1;
function getPoints(v1,v2){
      var max = 2000;
      var total = v1.length + v2.length;
      var amount = Math.round((v1.length * max / total)/100)*100
      var text = "+" + amount;
      if(v1.length==total){
        text += "<br>QUIPLOSH"
      }
      return text;
    }
function zoomOut(size,id){
  var d = new Date();
  var deltaTime =  d.getTime() - lastTime;

  var screens = ["lobbyScreen","questionScreen","welcomeScreen","selectRoomScreen","votingScreen"];
  for(var i =0; i<screens.length;i++){
          //document.getElementById(screens[i]).style.display = "none";
          $("#" + screens[i]).css({"transform":"scale(" + size + ")","transition: transform":".2s"});
         
        }
  if(size>0.1){
  setTimeout(zoomOut,1,size-0.0003*deltaTime,id);
  }else{
    for(var i =0; i<screens.length;i++){
          document.getElementById(screens[i]).style.display = "none";      
    }
    document.getElementById(id).style.display = "";
    zoomIn(0.1);
  }
}

function zoomIn(size,id){
  var d = new Date();
  var deltaTime =  d.getTime() - lastTime;
  var screens = ["lobbyScreen","questionScreen","welcomeScreen","selectRoomScreen","waitingScreen","votingScreen","leaderboardScreen"];
  for(var i =0; i<screens.length;i++){
          //document.getElementById(screens[i]).style.display = "none";
          $("#" + screens[i]).css({"transform":"scale(" + size + ")","transition: transform":".2s"});       
        }


    var canvasDiv = document.getElementById("frontImage1")
    if(canvasDiv.childElementCount>0){
    var c = canvasDiv.childNodes[0]
    console.log("test2",c);
    //fitToContainer(c,canvasDiv)
    var ctx = c.getContext("2d");
    //setCanvasImage(canvasDiv,c.get)
    }
  if(size<1){
    var final = size+0.0003*deltaTime;
    if(final > 1){
      final = 1;
    }
    setTimeout(zoomIn,1,final,id);
  }else{
    
  }
}

function leaderboard(){
      var $list = $("#players");
      console.log(players[player.room]);
      var rank = 1
      var playerArray = Object.keys(players[player.room]);
      playerArray.sort(function(a, b){
          return players[player.room][b].score - players[player.room][a].score;
      });
      var rank = 1;
      for (var i = 0; i < playerArray.length; i++){
        players[player.room][playerArray[i]].rank = i + 1
      }
      rank = 1;
     if($(".player").length == 0){
       player.lastRank = 0;
      for(var ii=0; ii < Object.keys(players[player.room]).length; ii++) {
          var i = Object.keys(players[player.room])[ii];
        
        var currentPlayer = players[player.room][i];
        players[player.room][i].lastRank = rank
			var $item = $(
				"<li class='player' style='top:" + 60*(rank-1)+22 + "px;'>" + 
          "<div class='rank'>" + currentPlayer.rank + "</div>" + 
          "<div class='pfp'>" + '<img style="float: left;" src="' + currentPlayer.img + '" class="myimg" />' + "</div>" + 
					"<div class='name'>" + currentPlayer.name + "</div>" +
					"<div class='score'>" + currentPlayer.score  + "</div>" +
        "</li>");
      $list.append($item); 
      //$(".player").eq(0).css("top", 22 + 60 + "px");
      rank +=1;
    }
    for(var i=0; i < Object.keys(players[player.room]).length; i++){
      var currentPlayer = players[player.room][Object.keys(players[player.room])[i]];
      $(".player").eq(currentPlayer.lastRank-1).css("top", 22 +(currentPlayer.lastRank-1) * 60 + "px");
    }
  }else{
    for(var i=0; i < Object.keys(players[player.room]).length; i++){
      var currentPlayer = players[player.room][Object.keys(players[player.room])[i]];
      $(".score").eq(currentPlayer.lastRank).text(currentPlayer.score);
      $(".rank").eq(currentPlayer.lastRank).text(currentPlayer.rank);
    }
  }  
    showScreen('leaderboardScreen');
    setTimeout(function() { 
    for(var i=0; i < Object.keys(players[player.room]).length; i++){
      var currentPlayer = players[player.room][Object.keys(players[player.room])[i]];
      $(".player").eq(currentPlayer.lastRank-1).css("top", 22 +(currentPlayer.rank-1) * 60 + "px");
    }
     }, 3000);
    }


function showScreen(id){
        var screens = ["lobbyScreen","questionScreen","welcomeScreen","selectRoomScreen","votingScreen","leaderboardScreen"];
        var d = new Date();
        lastTime = d.getTime();
        zoomOut(1,id);
    }

function joinRoom(room){
        console.log("Joined" +room);
        player.room = unescape(room);
        player.img = profilePictures[Math.floor(Math.random()*profilePictures.length)]
        socket.emit('update player', JSON.stringify(player));
        showScreen("lobbyScreen");
    }

  function kickPlayer(p){
      console.log("Kicked " +p);
      socket.emit('kick player', unescape(p));
  }

  
  
  $(function () {

    function readFile(file) {
	var reader = new FileReader();
	reader.onloadend = function () {
		processFile(reader.result, file.type);
	}
	reader.onerror = function () {
		alert('There was an error reading the file!');
	}
	reader.readAsDataURL(file);
}

function processFile(dataURL, fileType) {
	var maxWidth = 800;
	var maxHeight = 800;
	var image = new Image();
	image.src = dataURL;
	image.onload = function () {
		var width = image.width;
		var height = image.height;
		var shouldResize = (width > maxWidth) || (height > maxHeight);
		if (!shouldResize) {
			sendFile(dataURL);
			return;
		}
		var newWidth;
		var newHeight;
		if (width > height) {
			newHeight = height * (maxWidth / width);
			newWidth = maxWidth;
		} else {
			newWidth = width * (maxHeight / height);
			newHeight = maxHeight;
		}
		var canvas = document.createElement('canvas');
		canvas.width = newWidth;
		canvas.height = newHeight;
		var context = canvas.getContext('2d');
		context.drawImage(this, 0, 0, newWidth, newHeight);
		dataURL = canvas.toDataURL(fileType);
		sendFile(dataURL);
  };
  }
  
  function sendFile(fileData){
    console.log(fileData);
    socket.emit('submit answer',JSON.stringify(player),fileData,questions.pop());
    nextQuestion();
}
    function signin(e){
      e.preventDefault(); // prevents page reloading
      if ($('#m').val().length > 0){
      player.name = $('#m').val();
      showScreen("selectRoomScreen");

      socket.emit('request update');
      }else{
      var names = ["anna","bean","cat","dog","jamie","craig","fred","mike","toe"]
      player.name = names[Math.floor(Math.random()*names.length)];
      showScreen("selectRoomScreen");

      socket.emit('request update');
      }
      return false;
    }

    function submitAnswer(e){
      e.preventDefault();
      if ($('#answer').val().length > 0){
        socket.emit('submit answer',JSON.stringify(player),$('#answer').val(),questions.pop());
        nextQuestion();
      }else{
        $('#answer').val(Math.random());
      }
    }
    
    player.name = socket.id;
    socket.emit('request update');
    $('#signin').click(signin);
    $('#myForm').submit(signin);

    $('#answerButton').click(submitAnswer);
    $('#questionForm').submit(submitAnswer);

    $('#answerImage').on('change', function (e) {
		var file = e.target.files[0];

		if (file) {
			if (/^image\//i.test(file.type)) {
				readFile(file);
			} else {
				alert('Not a valid image!');
			}
		}
	});

    $('#leave').click(function(e){
      console.log("Leave" + socket.id);
      kickPlayer(socket.id);
    });
    $('#startGame').click(function(e){
      socket.emit("start game",player.room,1);
    });
    
    function updateRooms(rooms){
      $('#rooms').empty();
      if (Object.keys(rooms).length == 0){
        $('#rooms').append("No rooms found, why not create one!");
      }else{
        for(var room in rooms){
          console.log(room);
          //var text = "<li onClick=joinRoom("hys room")>hys room - 1 players</li>
         var text = "".concat("<li onClick=joinRoom(\"",escape(room),"\")><p>",room," - ",Object.keys(rooms[room]).length," players","</p></li>");
            console.log(text);
          $('#rooms').append(text);
      }
      }
    }

    
    function nextQuestion(){
      showScreen("questionScreen")
      if(round==1){
        document.getElementById("answer").style.display = ""; 
        document.getElementById("answerImage").style.display = "none"; 
      }else{
        document.getElementById("answer").style.display = "none" 
        document.getElementById("answerImage").style.display = ""; 
      }
      if(questions.length>0){
        setTimeout(function(){
          document.getElementById("questionLabel").innerHTML = questions[questions.length-1];
        },300);
        
        if ($('#answer').val().length>0){
          $('#answer').val("");
        }
      }else{
        showScreen("waitingScreen")
      }
    }

    
    function updateLobby(rooms){
      console.log("updating lobby " + JSON.stringify(rooms) + " " + player.hasOwnProperty("room"));
      
      if (player.hasOwnProperty("room")){

        if(player.isHost){
          document.getElementById("startGame").style.display = "";
        }else{
          document.getElementById("startGame").style.display = "none"; 
        }

        $('#lobbyName').text(player.room);
        $('#lobbyPlayers').empty();
        if (player.room in rooms){
          for(var p in rooms[player.room]){
            var currentPlayer = rooms[player.room][p];
            var text = '<tr><td><img style="float: left;" src="' + currentPlayer.img + '" class="myimg" /></td>'
            if (currentPlayer.isHost){
              text += "<td><p>" + rooms[player.room][p].name + " [HOST]" + "</p></td>"
            }else{
              if(player.isHost){
                //text = "<li onClick=clickPlayer(\"",escape(currentPlayer),"\")>"+ rooms[player.room][p].name + " click to kick" + "</li>"
                text += "<td onClick=kickPlayer(\"" + escape(p) + "\")><p>" + rooms[player.room][p].name + " [Kick] </p>" + "</td>"
              }else{
                text += "<td><p>" +  rooms[player.room][p].name + "</p>" + "</td>"
              }
            }
            text+="</tr>"
            $('#lobbyPlayers').append(text);
        }
        }
    }
    }

    

	  socket.on('update players', function(p){
      players = JSON.parse(p);
      updateRooms(players);
      updateLobby(players);
    });

    socket.on('kick player', function(p){
      if(socket.id == JSON.parse(p)){
        player.room = "";
        player.isHost = false;
       showScreen("selectRoomScreen");
      }
    });
    socket.on("start game", function(room, qs, r){
      questions = qs[socket.id];
      round = r;

      if(room = player.room){
        spaceBg.speedWhileLoading = 18;
        spaceBg.warp(300);

      }
      setTimeout(function(){
          nextQuestion();
			  },300)
    });

    $("#createroom").click(function(e){
      var roomName = player.room;
      player.room = player.name + "'s room"
      player.isHost = true;
      player.img = profilePictures[Math.floor(Math.random()*profilePictures.length)]
      socket.emit('update player', JSON.stringify(player));
      showScreen("lobbyScreen"); 
    });

    socket.on('countdown',function(secondsleft,room){
        if(room == player.room){
          $("#countdown").text(secondsleft);
        }
    });

    
    socket.on('show leaderboard', function(){
      leaderboard();
  });
    

    socket.on('show answers',function(question, answer1,answer2,p1,p2){
round = 2;
      $('#backName1').text(players[player.room][p1].name + "'s answer");
      $('#backName2').text(players[player.room][p2].name + "'s answer");
      if(round==2){
        document.getElementById('frontText1').style.display = "none";
        document.getElementById('frontText2').style.display = "none";
        document.getElementById('frontImage1').style.display = "";
        document.getElementById('frontImage2').style.display = "";
        setTimeout(function(){
          c1data = answer1;
          c2data = answer2;
        setCanvasImage(document.getElementById("frontImage1"),answer1);
        setCanvasImage(document.getElementById("frontImage2"),answer2);
        },600)
        $('#frontImage1').empty();
        $('#frontImage1').append('<canvas width="100%" height="100%"></canvas>');
        setCanvasImage(document.getElementById("frontImage1"),answer1);
        $('#frontImage2').empty();
        $('#frontImage2').append('<canvas width="100%" height="100%"></canvas>');
        setCanvasImage(document.getElementById("frontImage2"),answer2);
      }else{
        $('#frontText1').text(answer1);
        $('#frontText2').text(answer2);
        $('#backText1').text(answer1);
        $('#backText2').text(answer2);
        document.getElementById('frontText1').style.display = "";
        document.getElementById('frontText2').style.display = "";
        document.getElementById('frontImage1').style.display = "none";
        document.getElementById('frontImage2').style.display = "none";
      }
      
      
      console.log(players);
      console.log(p1);
      
    
      $('#questionlab').text(question);
      showScreen("votingScreen");
      hasVoted = false;
      autoSizeText();
      $("#card1").css({"border-width":"0px"})
      $("#card2").css({"border-width":"0px"})
    });

    socket.on("display votes",function(v10,v20){
      $("#countdown").text(v10 + " " + v20);
      var v1 = JSON.parse(v10);
      var v2 = JSON.parse(v20);
      autoSizeText();
      $('#votes1').empty();
      $('#votes2').empty();
      for (var p in v1){
        $('#votes1').append(players[player.room][v1[p]].name  + "<br>")
      }
      for (var p in v2){
        $('#votes2').append(players[player.room][v2[p]].name  + "<br>")
      }
      document.getElementById('leftcard').classList.toggle('flipped');
      setTimeout(function(){
        document.getElementById('rightcard').classList.toggle('flipped');
        },300)
      setTimeout(function(){
        document.getElementById('frontText1').style.display = "";
        document.getElementById('frontText2').style.display = "";
        document.getElementById('frontImage1').style.display = "none";
        document.getElementById('frontImage2').style.display = "none";
        $("#frontText1").empty();
        $("#frontText2").empty();
        $("#frontText1").append( getPoints(v1,v2));
        $("#frontText2").append( getPoints(v2,v1));
        document.getElementById('leftcard').classList.toggle('flipped');
        setTimeout(function(){
        document.getElementById('rightcard').classList.toggle('flipped');
        },300)
      },3500)
    });

    

    function vote(card){
      if(!hasVoted){
      hasVoted = true;
      var c;
      if(card == 1){
          c= $("#card1");
      }else{
        c = $("#card2");
      }
      c.css({ "border-width":"20px"});
      socket.emit("vote",player.room,card-1);
    };
    }
    $("#card1").click(function(e){
      vote(1);
    });
    $("#card2").click(function(e){
      vote(2);
    });
  });
  function setCanvasImage(canvasDiv, imgData){
    var c = canvasDiv.childNodes[0]
    var img = new Image();
    img.onload = function() {
        var hRatio = c.width / img.width    ;
        var vRatio = c.height / img.height  ;
        var ratio  = Math.min ( hRatio, vRatio );
        var ctx = c.getContext("2d");
        console.log("height1: ", hRatio);
        console.log("width1:", vRatio);
        console.log("height1-1: ", c.width );
        console.log("width1=1:", c.height );
        ctx.drawImage(img, 0,0, img.width, img.height, 0,0,img.width*ratio, img.height*ratio);
    };
    img.src =imgData;
    fitToContainer(c,canvasDiv)
}
var c1data = -1;
var c2data;
var lastWidth =-1;
setInterval(() => {
  if(c1data != -1){
    var div1 = document.getElementById("frontImage1");
    if(div1.clientWidth!=lastWidth){
      if(div1.childElementCount>0){
        lastWidth=div1.clientWidth;
      setCanvasImage(div1.childNodes[0],c1data);
      setCanvasImage(document.getElementById("frontImage2").childNodes[0],c2data);
      } 
    }
  }
}, 50);
function fitToContainer(canvas,theDiv){
  canvas.width = theDiv.clientWidth;
    canvas.height = theDiv.clientHeight;
  if(theDiv.clientWidth==0){
    canvas.width = 200;
    canvas.height = 200;
  }
  
}
</script>
  <p id="playersOnline">test</p>
 </body>
</html>